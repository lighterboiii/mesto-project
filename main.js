(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{C5:()=>K});var t={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active",submitPhotoSelector:"create-card-button"},n=function(){var e=Array.from(document.querySelectorAll(".form__item-error")),n=Array.from(document.querySelectorAll(t.inputSelector));e.forEach((function(e){e.textContent=""})),n.forEach((function(e){e.classList.remove(t.inputErrorClass)}))},o=function(e,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(n.classList.remove(t.inactiveButtonClass),n.removeAttribute("disabled",!0)):(n.classList.add(t.inactiveButtonClass),n.setAttribute("disabled",!0))},r=function(e){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o(n,r),n.forEach((function(c){c.addEventListener("input",(function(){o(n,r),function(e,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(e,n){var o=e.querySelector(".".concat(n.id,"-error"));o.classList.remove(t.errorClass),n.classList.remove(t.inputErrorClass),o.textContent=""}(e,n):function(e,n,o){var r=e.querySelector(".".concat(n.id,"-error"));n.classList.add(t.inputErrorClass),r.textContent=o,r.classList.add(t.errorClass)}(e,n,n.validationMessage)}(e,c)}))}))},c=(document.querySelector(".form__button"),document.querySelector(".profile__button")),a=document.querySelector(".add-button"),u=document.querySelector(".profile-close-button"),i=document.querySelector(".popup__photo-close-button"),s=document.querySelector(".photo__close-button"),l=document.querySelector(".profile__avatar-button"),d=document.querySelector(".avatar-close-button"),m=document.querySelector(".popup__avatar"),f=document.querySelector(".avatar-form"),v=document.querySelector(".form__item-avatar"),_=document.querySelector(".popup__profile"),p=document.querySelector(".form__item_type_link"),h=document.querySelector(".form__item_type_photo"),y=document.querySelector(".popup__add-photo"),b=document.querySelector(".form__item_type_name"),S=document.querySelector(".form__item_type_job"),q=document.querySelector(".profile__name"),L=document.querySelector(".profile__caption"),E=document.querySelector(".card-form"),k=document.querySelector(".profile__avatar"),g=document.querySelector(".photo-card__image"),C=document.querySelector(".photo-card__caption"),j=document.querySelector(".elements"),A=document.querySelector(".photo-card"),P=document.querySelector("#elements__template").content,w=document.querySelector(".profile-submit-button"),x=document.querySelector(".create-card-button"),U=document.querySelector(".avatar-button"),D=document.querySelector(".popup__delete"),O=document.querySelector(".delete-close-button");function B(){"Escape"===event.key&&M(document.querySelector(".popup_opened"))}function T(e){e.classList.add("popup_opened"),window.addEventListener("keydown",B)}function M(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",B)}function N(e){e.target.classList.contains("popup")&&M(e.target)}function J(e,t,n){t.textContent=e?"Сохранение...":n}var H,V={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"79a19db7-3f97-4425-9bfc-faae1f13f72c","Content-Type":"application/json"}},z=function(){return fetch("".concat(V.baseUrl,"/users/me"),{headers:V.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},F=function(){return fetch("".concat(V.baseUrl,"/cards"),{headers:V.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function G(e,t){var n=P.querySelector(".elements__item").cloneNode(!0),o=n.querySelector(".elements__img"),r=n.querySelector(".elements__caption"),c=n.querySelector(".like-button"),a=n.querySelector(".delete-button"),u=n.querySelector(".like-count"),i=e.owner._id;return r.textContent=e.name,o.src=e.link,o.alt=e.name,function(e,t,n){F().then((function(){e.likes.forEach((function(e){e._id===t&&n.classList.add("like-button_active")}))})).catch((function(e){console.log(e)}))}(e,t,c),c.addEventListener("mousedown",(function(t){t.target.classList.contains("like-button_active")?(c.classList.remove("like-button_active"),function(e){return fetch("".concat(V.baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:V.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){u.textContent=String(e.likes.length)})).catch((function(e){console.log(e)}))):(c.classList.add("like-button_active"),function(e){return fetch("".concat(V.baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:V.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){u.textContent=String(e.likes.length)})).catch((function(e){console.log(e)})))})),u.textContent=String(e.likes.length),i===t&&(a.style.visibility="visible",a.addEventListener("click",(function(e){T(D),D.addEventListener("submit",(function(){event.preventDefault(),a.closest(".elements__item").remove(),M(D),function(e){(function(e){return fetch("".concat(V.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:V.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e._id).catch((function(e){console.log(e)}))}(e)}))}))),o.addEventListener("click",I),n}function I(e){g.src=e.target.getAttribute("src"),C.textContent=e.target.getAttribute("alt"),g.alt=e.target.getAttribute("alt"),T(A)}function K(e,t){b.value=e,S.value=t}function Q(e,t){q.textContent=e,L.textContent=t}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),r(e)}))}(t),Promise.all([z(),F()]).then((function(e){H=e[0]._id,k.src=e[0].avatar,Q(e[0].name,e[0].about),e[1].forEach((function(e){var t;t=G(e,H),j.append(t)}))})).catch((function(e){console.log(e)})),s.addEventListener("click",(function(){return M(A)})),O.addEventListener("click",(function(){return M(D)})),c.addEventListener("click",(function(){K(q.textContent,L.textContent),T(_),n()})),u.addEventListener("click",(function(){return M(_)})),_.addEventListener("submit",(function(e){var t,n;e.preventDefault(),J(!0,w,"Сохранить"),(t=b.value,n=S.value,fetch("".concat(V.baseUrl,"/users/me"),{method:"PATCH",headers:V.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){Q(b.value,S.value),M(_)})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){E.reset(),T(y),n()})),i.addEventListener("click",(function(){return M(y)})),E.addEventListener("submit",(function(e){var n,o;e.preventDefault(),J(!0,x,"Создать"),(n=h.value,o=p.value,fetch("".concat(V.baseUrl,"/cards"),{method:"POST",headers:V.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var n;!function(e){var t;t=G(e,H),j.prepend(t)}(e),M(y),E.reset(),(n=document.querySelector(t.submitButtonSelector)).setAttribute("disabled",!0),n.classList.add(t.inactiveButtonClass)})).catch((function(e){console.log(e)}))})),_.addEventListener("mousedown",N),y.addEventListener("mousedown",N),A.addEventListener("mousedown",N),D.addEventListener("mousedown",N),m.addEventListener("mousedown",N),l.addEventListener("click",(function(){f.reset(),T(m),n()})),d.addEventListener("click",(function(){return M(m)})),m.addEventListener("submit",(function(e){var t;e.preventDefault(),J(!0,U,"Сохранить"),(t=v.value,fetch("".concat(V.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:V.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){k.src=e.avatar,M(m),f.reset()})).catch((function(e){console.log(e)}))})),document.addEventListener("DOMContentLoaded",z)})();
//# sourceMappingURL=main.js.map